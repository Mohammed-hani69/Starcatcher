<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Star Catcher</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sigmar+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='image/STAR CATCHER FINAL LOGO-11.png') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap">
    <style>
        :root {
            --primary-red: #e50914;
            --dark-red: #b30710;
            --accent-gold: #ffc107;
            --black: #121212;
            --dark-gray: #1a1a1a;
            --light-gray: #2d2d2d;
            --text-light: #f8f9fa;
        }
        
        body {
            background-color: var(--black);
            color: var(--text-light);
            font-family: 'Cairo', sans-serif;
        }
        
        /* Navbar Styling */
        .navbar {
            background: linear-gradient(to right, #000000, #440000);
            box-shadow: 0 4px 15px rgba(229, 9, 20, 0.2);
            padding: 15px 0;
        }
        
        .navbar-brand {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-red) !important;
            text-shadow: 0 0 10px rgba(229, 9, 20, 0.5);
            transition: all 0.3s ease;
            padding-left: 20px;
            display: flex;
            align-items: center;
        }

        .navbar-brand img {
            height: 70px;
            width: auto;
            transition: all 0.3s ease;
        }

        @media (max-width: 768px) {
            .navbar-brand img {
                height: 80px;
            }
        }

        @media (max-width: 480px) {
            .navbar-brand img {
                height: 65px;
            }
        }
        
        .nav-link {
            color: var(--text-light) !important;
            font-weight: 600;
            margin: 0 10px;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 0;
            left: 0;
            background-color: var(--primary-red);
            transition: width 0.3s ease;
        }
        
        .nav-link:hover::after {
            width: 100%;
        }
        
        .coins-display {
            background-color: rgba(255, 193, 7, 0.2);
            border-radius: 20px;
            padding: 5px 15px ;
            margin-left: 15px;
            color: var(--accent-gold);
            font-weight: 700;
        }

        /* World Cup Badge */
        .world-cup-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--primary-red);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }
        
        /* Hero Section */
        .hero-section {
            background: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(130,0,0,0.8) 100%), url('/static/images/stadium-bg.jpg');
            background-size: cover;
            background-position: center;
            padding: 80px 0;
            margin-bottom: 50px;
            border-bottom: 4px solid var(--primary-red);
            position: relative;
            overflow: hidden;
        }
        
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, transparent 20%, var(--black) 150%);
        }
        
        .hero-title {
            font-size: 3.5rem;
            font-weight: 800;
            text-transform: uppercase;
            margin-bottom: 25px;
            background: linear-gradient(to right, var(--primary-red), var(--accent-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        
        /* Subscription Cards */
        .subscription-card {
            background: linear-gradient(145deg, var(--dark-gray), var(--black));
            border: none;
            border-radius: 15px;
            overflow: hidden;
            transform: translateY(0);
            transition: all 0.4s ease;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
            position: relative;
        }
        
        .subscription-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            z-index: -1;
            border-radius: 16px;
        }
        
        .standard-card::before {
            background: linear-gradient(45deg, var(--primary-red), transparent, var(--primary-red));
            animation: glowing-red 3s linear infinite;
        }
        
        .premium-card::before {
            background: linear-gradient(45deg, var(--accent-gold), transparent, var(--accent-gold));
            animation: glowing-gold 3s linear infinite;
        }
        
        @keyframes glowing-red {
            0% { opacity: 0.8; }
            50% { opacity: 0.5; }
            100% { opacity: 0.8; }
        }
        
        @keyframes glowing-gold {
            0% { opacity: 0.8; }
            50% { opacity: 0.5; }
            100% { opacity: 0.8; }
        }
        
        .subscription-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(229, 9, 20, 0.3);
        }
        
        .subscription-card .card-header {
            background: linear-gradient(to right, var(--black), var(--dark-gray));
            padding: 20px;
            border-bottom: 2px solid var(--primary-red);
        }
        
        .premium-card .card-header {
            border-bottom: 2px solid var(--accent-gold);
        }
        
        .subscription-card .card-title {
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
        }
        
        .subscription-card .card-body {
            padding: 30px;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
            margin-bottom: 30px;
        }
        
        .feature-list li {
            margin-bottom: 15px;
            padding-right: 30px;
            position: relative;
            font-size: 1.1rem;
            color: #e1e1e1;
            line-height: 1.6;
        }
        
        .feature-list li::before {
            content: '\f00c';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            right: 0;
            color: var(--primary-red);
        }
        
        .premium-card .feature-list li::before {
            color: var(--accent-gold);
        }
        
        .subscription-btn {
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 50px;
            border: none;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .standard-btn {
            background-color: var(--primary-red);
            color: white;
        }
        
        .standard-btn:hover {
            background-color: var(--dark-red);
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(229, 9, 20, 0.5);
        }
        
        .premium-btn {
            background-color: var(--accent-gold);
            color: var (--black);
        }
        
        .premium-btn:hover {
            background-color: #e8af00;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.5);
        }
        
        /* Packs Section */
        .section-title {
            position: relative;
            display: inline-block;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 40px;
            color: var(--primary-red);
            text-transform: uppercase;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100px;
            height: 3px;
            background-color: var(--primary-red);
        }
        
        .pack-card {
            background: linear-gradient(145deg, var(--dark-gray), var(--black));
            padding: 20px;
            background-origin: padding-box;
            background-clip: padding-box;
            border: 1px solid var(--light-gray);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            height: 100%;
            position: relative;
            min-height: 580px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            align-items: flex-end;
            transition: transform 0.3s ease;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        @import url('https://fonts.googleapis.com/css2?family=Sigmar+One&display=swap'); /* خط عريض وغريب */

        .pack-name {
            font-family: 'Sigmar One', sans-serif;
            font-size: 2rem;
            font-weight: 900;
            text-align: center;
            color: #FF6B00; /* برتقالي */
            margin-bottom: 20px;
            position: absolute;
            bottom: 470px;
            left: 50%;
            transform: translateX(-50%) translateY(0) translateZ(30px);
            z-index: 5;
            text-transform: uppercase;
            text-shadow: 
                2px 2px 0 #FF0000,
                2px 2px 0 #FF0000,
                2px 2px 0 #FF0000,
                2px 2px 0 #FF0000,
                4px 4px 0 #CC0000,
                4px 4px 0 #CC0000,
                4px 4px 0 #CC0000,
                4px 4px 0 #CC0000,
                6px 6px 0 #990000,
                6px 6px 0 #990000,
                6px 6px 0 #990000,
                6px 6px 0 #990000,
                8px 8px 10px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
            perspective: 1000px;
            transform-style: preserve-3d;
        }

        .pack-name:hover {
            transform: translateX(-50%) translateY(-5px) translateZ(50px);
            text-shadow: 
                3px 3px 0 #FF0000,
                6px 6px 0 #CC0000,
                9px 9px 0 #990000,
                12px 12px 15px rgba(0, 0, 0, 0.7);
        }

        .pack-card:hover .pack-name,
        .pack-card:hover .pack-price,
        .pack-card:hover .pack-btn {
            transform: perspective(1000px) translateZ(30px);
        }

        .pack-card .overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            
            z-index: 1;
        }

        .pack-card .card-body {
            position: relative;
            z-index: 2;
            width: 100%;
            padding: 20px;
            background: transparent;
        }

        .pack-card:hover .overlay {
            background: linear-gradient(
                to bottom,
                rgba(0, 0, 0, 0.3) 0%,
                rgba(0, 0, 0, 0.7) 50%,
                rgba(0, 0, 0, 0.95) 100%
            );
        }
        
        .pack-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 25px rgba(229, 9, 20, 0.25);
            border-color: var(--primary-red);
        }
        
        .pack-card .card-body {
            position: relative;
            z-index: 2;
            width: 100%;
            padding: 20px;
            background: linear-gradient(
                to top,
                rgba(0, 0, 0, 0.9) 0%,
                rgba(0, 0, 0, 0.7) 50%,
                transparent 100%
            );
        }
        
        .pack-info {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .pack-detail {
            margin-bottom: 10px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            color: #adb5bd;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 20px;
        }
        
        .pack-price {
            display: inline-block;
            background: linear-gradient(145deg, rgba(255, 193, 7, 0.2), rgba(255, 193, 7, 0.1));
            color: var(--accent-gold);
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1.4rem;
            font-weight: 700;
            border: 1px solid rgba(255, 193, 7, 0.3);
            transition: all 0.3s ease;
            transform-style: preserve-3d;
            transform: perspective(1000px) translateZ(10px);
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.2),
                        inset 0 2px 5px rgba(255, 255, 255, 0.1);
        }

        .pack-price:hover {
            transform: perspective(1000px) translateZ(20px) scale(1.05);
            box-shadow: 0 8px 20px rgba(255, 193, 7, 0.3),
                        inset 0 2px 5px rgba(255, 255, 255, 0.2);
        }

        .pack-btn {
            padding: 12px 25px;
            font-weight: 700;
            font-size: 1.1rem;
            border-radius: 50px;
            border: none;
            background: linear-gradient(145deg, var(--primary-red), var(--dark-red));
            color: white;
            transition: all 0.3s ease;
            width: 100%;
            transform-style: preserve-3d;
            transform: perspective(1000px) translateZ(15px);
            box-shadow: 0 5px 15px rgba(229, 9, 20, 0.3),
                        inset 0 2px 5px rgba(255, 255, 255, 0.1);
            position: relative;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .pack-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(145deg, rgba(255,255,255,0.1), transparent);
            border-radius: 50px;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .pack-btn:hover {
            background: linear-gradient(145deg, var(--dark-red), var(--primary-red));
            transform: perspective(1000px) translateZ(25px) scale(1.05);
            box-shadow: 0 8px 20px rgba(229, 9, 20, 0.4),
                        inset 0 2px 5px rgba(255, 255, 255, 0.2);
        }

        .pack-btn:hover::before {
            opacity: 1;
        }

        /* Daily Pack */
        .daily-pack-card {
            background: linear-gradient(to bottom right, var(--black), var(--dark-gray));
            border: none;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1;
        }
        
        .daily-pack-card::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border-radius: 20px;
            background: linear-gradient(45deg, var(--primary-red), var(--accent-gold), var(--primary-red));
            z-index: -1;
            animation: rotate 5s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .daily-pack-card::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            background: linear-gradient(to bottom right, var(--black), var(--dark-gray));
            border-radius: 15px;
            z-index: -1;
        }
        
        .daily-pack-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
            color: white;
            text-shadow: 0 0 10px rgba(229, 9, 20, 0.5);
        }
        
        .daily-pack-btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 50px;
            border: none;
            background: linear-gradient(to right, var(--primary-red), var(--dark-red));
            color: white;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .daily-pack-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: all 0.6s ease;
        }
        
        .daily-pack-btn:hover::before {
            left: 100%;
        }
        
        .daily-pack-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(229, 9, 20, 0.6);
        }
        
        .countdown-text {
            margin-top: 20px;
            font-size: 1.1rem;
            color: #adb5bd;
            text-align: center;
        }

        /* إضافة CSS جديد للعداد بعد التصميم السابق */
        .countdown-timer {
            background: linear-gradient(145deg, var (--dark-gray), var(--black));
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--primary-red);
        }

        .countdown-timer::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--primary-red), var(--accent-gold));
            z-index: -1;
            animation: borderGlow 3s ease-in-out infinite;
        }

        @keyframes borderGlow {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

        .countdown-digit {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 60px;
            height: 60px;
            background: linear-gradient(145deg, var(--black), var(--dark-gray));
            margin: 0 5px;
            border-radius: 10px;
            font-size: 2rem;
            font-weight: bold;
            color: var (--accent-gold);
            text-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
            position: relative;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .countdown-separator {
            display: inline-block;
            margin: 0 5px;
            font-size: 2rem;
            color: var(--primary-red);
            animation: pulse 1s infinite;
            vertical-align: middle;
        }

        .countdown-label {
            display: block;
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 5px;
            opacity: 0.8;
        }

        .countdown-wrapper {
            padding: 10px;
            border-radius: 20px;
            display: inline-block;
        }

        .countdown-unit {
            display: inline-block;
            text-align: center;
            margin: 0 5px;
        }
        
        .price-tag {
            text-align: center;
            margin: 20px 0;
        }

        .pack-price {
            display: inline-block;
            background: transparent;
            color: var(--accent-gold);
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .pack-price small {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-right: 5px;
            color: var(--accent-gold);
        }

        .pack-price:hover {
            transform: translateY(-2px);
        }

        .pack-price i {
            color: var(--accent-gold);
            margin-left: 5px;
        }

        .premium-price {
            color: var(--accent-gold);
        }
        
        /* Pack Modal */
        .modal-content {
            background: linear-gradient(to bottom, var(--dark-gray), var(--black));
            border: 2px solid var(--primary-red);
            border-radius: 15px;
        }
        
        /* Pack Opening Modal Player Cards */
        #players-reveal .player-card,
        #daily-players-reveal .player-card {
            background: linear-gradient(to bottom, var(--dark-gray), var(--black));
            border-radius: 15px;
            padding: 15px;
            margin: 8px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            display: inline-block;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            width: calc(33.33% - 16px);
        }

        #players-reveal .player-image-container,
        #daily-players-reveal .player-image-container {
            width: 100%;
            height: 0;
            padding-bottom: 100%;
            position: relative;
            margin-bottom: 10px;
        }

        #players-reveal .player-image-container img,
        #daily-players-reveal .player-image-container img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            .modal-dialog.modal-lg {
                max-width: 95%;
                margin: 10px auto;
            }

            #players-reveal .player-card,
            #daily-players-reveal .player-card {
                width: calc(50% - 16px);
                padding: 10px;
            }

            #players-reveal .player-name,
            #daily-players-reveal .player-name {
                font-size: 0.9rem;
            }

            #players-reveal .player-rating,
            #daily-players-reveal .player-rating {
                font-size: 0.8rem;
                padding: 2px 8px;
            }

            #players-reveal .player-details,
            #daily-players-reveal .player-details {
                font-size: 0.75rem;
            }
        }

        @media (max-width: 480px) {
            #players-reveal .player-card,
            #daily-players-reveal .player-card {
                margin: 4px;
                width: calc(50% - 8px);
            }
        }

        .player-card {
            background: linear-gradient(to bottom, var(--dark-gray), var(--black));
            border-radius: 15px;
            padding: 20px;
            margin: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            display: inline-block;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .player-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            z-index: -1;
            border-radius: 17px;
            background: linear-gradient(45deg, var(--primary-red), var(--accent-gold), var(--primary-red));
        }
        
        .player-card img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid var(--primary-red);
        }
        
        .player-name {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: white;
        }
        
        .player-rating {
            display: inline-block;
            background-color: var(--dark-gray);
            color: var(--accent-gold);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
        }
        
        .add-to-collection-btn {
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 50px;
            border: none;
            background: linear-gradient(to right, var(--primary-red), var(--dark-red));
            color: white;
            margin-top: 30px;
            transition: all 0.3s ease;
        }
        
        .add-to-collection-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(229, 9, 20, 0.5);
        }

        .feature-item {
            font-size: 1.1rem;
            color: #e1e1e1;
            line-height: 1.8;
            margin-bottom: 1rem;
            position: relative;
            padding-right: 30px;
            text-align: right;
        }

        .price-wrapper {
            text-align: center;
            margin: 25px 0;
            position: relative;
        }

        .pack-price {
            display: inline-block;
            background: transparent;
            color: var(--accent-gold);
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .pack-price small {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-right: 5px;
            color: var(--accent-gold);
        }

        .pack-price:hover {
            transform: translateY(-2px);
        }

        .pack-price i {
            color: var(--accent-gold);
            margin-left: 5px;
        }

        .premium-price {
            color: var(--accent-gold);
        }

        .premium-card .feature-list li::before {
            color: var(--accent-gold);
        }

        .premium-card .card-header {
            border-bottom: 2px solid var(--accent-gold);
        }

        .premium-price {
            color: var(--accent-gold);
        }

        .premium-price:hover {
            box-shadow: 0 6px 20px rgba(255, 193, 7, 0.4);
        }

        .premium-btn {
            background-color: var(--accent-gold);
            color: var(--black);
        }

        .premium-btn:hover {
            background-color: #e8af00;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.5);
        }

        /* Responsive Navbar Styling */
        @media (max-width: 991px) {
            .navbar-collapse {
                background: linear-gradient(to bottom, var(--black), var(--dark-gray));
                padding: 1rem;
                border-radius: 10px;
                margin-top: 1rem;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            }

            .navbar-nav {
                text-align: center;
            }

            .nav-link {
                padding: 0.8rem 1rem;
                margin: 5px 0;
                border-radius: 5px;
            }

            .nav-link:hover {
                background-color: rgba(229, 9, 20, 0.1);
            }

            .coins-display {
                margin: 10px auto;
                display: inline-block;
            }

            .navbar-toggler {
                border: none;
                background: transparent;
                padding: 0.5rem;
            }

            .navbar-toggler:focus {
                box-shadow: none;
            }

            .navbar-toggler-icon {
                background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(229, 9, 20, 1)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
            }
        }

        /* World Cup Badge Responsive */
        @media (max-width: 768px) {
            .world-cup-badge {
                display: none;
            }
        }

        /* Banner Styling */
        .banner-container {
            padding: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .banner-wrapper {
            background: linear-gradient(145deg, var(--dark-gray), var(--black));
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--primary-red);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .banner-wrapper:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(229, 9, 20, 0.3);
        }

        .banner-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        .banner-text {
            flex: 1;
        }

        .banner-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-light);
            margin-bottom: 10px;
        }

        .banner-description {
            color: #adb5bd;
            margin-bottom: 15px;
        }

        .banner-cta {
            background: var(--primary-red);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .banner-cta:hover {
            background: var(--dark-red);
            transform: scale(1.05);
            color: white;
        }

        .banner-image {
            flex: 0 0 auto;
            width: 200px;
            height: 120px;
            border-radius: 10px;
            overflow: hidden;
        }

        .banner-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Responsive Banner */
        @media (max-width: 768px) {
            .banner-content {
                flex-direction: column;
                text-align: center;
            }

            .banner-image {
                width: 100%;
                max-width: 300px;
                margin: 0 auto;
            }
            
            .banner-wrapper {
                margin: 10px;
            }
        }

        /* VIP Package Styles */
        .vip-card {
            position: relative;
            overflow: visible;
        }
        
        .vip-badge {
            position: absolute;
            top: -15px;
            right: -15px;
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
        }
        
        .vip-badge.vip {
            background: linear-gradient(135deg, #614385, #516395);
        }
        
        .vip-badge.vip-plus {
            background: linear-gradient(135deg, #5e0094, #8e44ad);
        }
        
        .vip-badge.vip-elite {
            background: linear-gradient(135deg, #b91d73, #f953c6);
        }
        
        .package-details {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid;
        }
        
        .vip .package-details {
            border-color: #516395;
        }
        
        .vip-plus .package-details {
            border-color: #8e44ad;
        }
        
        .vip-elite .package-details {
            border-color: #f953c6;
        }
        
        .package-detail-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            color: #e1e1e1;
        }
        
        .package-detail-item i {
            margin-left: 10px;
            font-size: 1.1rem;
        }
        
        .vip .package-detail-item i {
            color: #516395;
        }
        
        .vip-plus .package-detail-item i {
            color: #8e44ad;
        }
        
        .vip-elite .package-detail-item i {
            color: #f953c6;
        }
        
        .package-price {
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 20px 0;
            color: var(--accent-gold);
        }
        
        .package-duration {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            margin-top: 10px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Add to existing subscription card styles */
        .subscription-card.vip {
            background: linear-gradient(145deg, #1a1a1a, #2c2c2c);
            border: 1px solid #516395;
        }
        
        .subscription-card.vip-plus {
            background: linear-gradient(145deg, #1a1a1a, #2d1a3a);
            border: 1px solid #8e44ad;
        }
        
        .subscription-card.vip-elite {
            background: linear-gradient(145deg, #1a1a1a, #3a1a2d);
            border: 1px solid #f953c6;
        }

        /* VIP Package Styles - Update/Add these styles */
        .vip-badges {
            position: absolute;
            top: -15px;
            right: -15px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .vip-badge {
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
        }

        .vip-badge.vip {
            background: linear-gradient(135deg, #614385, #516395);
        }

        .vip-badge.vip-plus {
            background: linear-gradient(135deg, #5e0094, #8e44ad);
        }

        .package-features {
            display: grid;
            gap: 10px;
            margin: 15px 0;
        }

        .feature-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 5px 12px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
        }

        .feature-badge i {
            color: var(--accent-gold);
        }

        /* Update VIP Package Styles */
        .vip-badges {
            position: absolute;
            top: -15px;
            right: -15px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .vip-badge {
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
            animation: neonGlow 1.5s ease-in-out infinite alternate;
        }

        @keyframes neonGlow {
            from {
                box-shadow: 0 0 10px #fff,
                            0 0 20px #fff,
                            0 0 30px currentColor,
                            0 0 40px currentColor;
            }
            to {
                box-shadow: 0 0 5px #fff,
                            0 0 10px #fff,
                            0 0 15px currentColor,
                            0 0 20px currentColor;
            }
        }

        .vip-badge.vip {
            background: linear-gradient(135deg, #4834d4, #686de0);
            color: #686de0;
        }

        .vip-badge.vip-plus {
            background: linear-gradient(135deg, #be2edd, #e056fd);
            color: #e056fd;
        }

        .vip-badge.vip-elite {
            background: linear-gradient(135deg, #ff0844, #ffb199);
            color: #ff0844;
        }

        .subscription-card.vip {
            background: linear-gradient(145deg, #1a1a1a, #2c2c2c);
            border: 1px solid #4834d4;
        }

        .subscription-card.vip-plus {
            background: linear-gradient(145deg, #1a1a1a, #2d1a3a);
            border: 1px solid #be2edd;
        }

        .subscription-card.vip-elite {
            background: linear-gradient(145deg, #1a1a1a, #3a1a2d);
            border: 1px solid #ff0844;
            box-shadow: 0 0 30px rgba(255, 8, 68, 0.2);
        }

        /* Update VIP Package Styles */
        .vip-badges {
            position: absolute;
            top: -15px;
            right: -15px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .vip-badge {
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
            transition: all 0.3s ease;
        }

        .vip-badge.vip {
            background: linear-gradient(135deg, #6C5CE7, #5758BB);
        }

        .vip-badge.vip-plus {
            background: linear-gradient(135deg, #a55eea, #8854d0);
        }

        .vip-badge.vip-elite {
            background: linear-gradient(135deg, #D6336C, #e84393);
        }

        .subscription-card {
            transition: all 0.4s ease;
            border: 2px solid transparent;
            background-size: 200% 200%;
            animation: gradientShift 8s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .subscription-card.vip {
            background: linear-gradient(145deg, #1a1a1a, #2c2c2c);
            border-image: linear-gradient(135deg, #6C5CE7, #5758BB) 1;
        }

        .subscription-card.vip-plus {
            background: linear-gradient(145deg, #1a1a1a, #2d1a3a);
            border-image: linear-gradient(135deg, #a55eea, #8854d0) 1;
        }

        .subscription-card.vip-elite {
            background: linear-gradient(145deg, #1a1a1a, #3a1a2d);
            border-image: linear-gradient(135deg, #D6336C, #e84393) 1;
        }

        .subscription-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .package-details {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .feature-badge {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .feature-badge:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(-5px);
        }

        .feature-badge i {
            font-size: 1.1rem;
        }

        .vip .feature-badge i {
            color: #6C5CE7;
        }

        .vip-plus .feature-badge i {
            color: #a55eea;
        }

        .vip-elite .feature-badge i {
            color: #D6336C;
        }

        .subscription-btn {
            padding: 12px 30px;
            border-radius: 12px;
            font-weight: 600;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            border: none;
            background-size: 200% auto;
        }

        .vip .subscription-btn {
            background-image: linear-gradient(45deg, #6C5CE7, #5758BB, #6C5CE7);
            color: white;
        }

        .vip-plus .subscription-btn {
            background-image: linear-gradient(45deg, #a55eea, #8854d0, #a55eea);
            color: white;
        }

        .vip-elite .subscription-btn {
            background-image: linear-gradient(45deg, #D6336C, #e84393, #D6336C);
            color: white;
        }

        .subscription-btn:hover {
            background-position: right center;
            transform: scale(1.02);
        }

        /* Update VIP Package Styles */
        .vip-badges {
            position: absolute;
            top: -12px;
            right: -12px;
            display: flex;
            gap: 8px;
            z-index: 10;
        }

        .vip-badge {
            padding: 6px 12px;
            border-radius: 15px;
            color: white;
            font-weight: 700;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .vip-badge.vip {
            background: linear-gradient(135deg, #483D8B, #4B0082);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .vip-badge.vip-plus {
            background: linear-gradient(135deg, #800080, #4B0082);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .vip-badge.vip-elite {
            background: linear-gradient(135deg, #8B0000, #800000);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .subscription-card {
            background: linear-gradient(145deg, #1a1a1a, #2c2c2c);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.4s ease;
        }

        .subscription-card.vip {
            border-color: rgba(72, 61, 139, 0.5);
        }

        .subscription-card.vip-plus {
            border-color: rgba(128, 0, 128, 0.5);
        }

        .subscription-card.vip-elite {
            border-color: rgba(139, 0, 0, 0.5);
        }

        .subscription-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2);
        }

        .feature-badge {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 8px 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .feature-badge:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(-3px);
        }

        .vip .feature-badge i {
            color: #483D8B;
        }

        .vip-plus .feature-badge i {
            color: #800080;
        }

        .vip-elite .feature-badge i {
            color: #8B0000;
        }

        /* Toast Notifications Styling */
        .custom-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: none;
            min-width: 300px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            color: white;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: translateX(100%);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .custom-toast.show {
            transform: translateX(0);
            display: block;
        }

        .toast-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .toast-icon {
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin-right: 12px;
            font-size: 1.2rem;
        }

        .toast-success .toast-icon {
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
        }

        .toast-error .toast-icon {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
        }

        .toast-title {
            font-weight: 600;
            font-size: 1.1rem;
            flex-grow: 1;
        }

        .toast-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0;
            transition: color 0.3s ease;
        }

        .toast-close:hover {
            color: white;
        }

        .toast-body {
            font-size: 0.95rem;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.8);
        }

        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0 0 15px 15px;
            overflow: hidden;
        }

        .toast-progress-bar {
            height: 100%;
            width: 100%;
            transform-origin: left;
            animation: progress 3s linear forwards;
        }

        .toast-success .toast-progress-bar {
            background: #2ed573;
        }

        .toast-error .toast-progress-bar {
            background: #ff4757;
        }

        @keyframes progress {
            from { transform: scaleX(1); }
            to { transform: scaleX(0); }
        }

        .toast-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
        }

        .toast-detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .toast-detail-label {
            color: rgba(255, 255, 255, 0.6);
        }

        .toast-detail-value {
            font-weight: 600;
        }
    </style>

    <!-- Add Toast Container after closing </style> tag -->
    <div id="subscriptionToast" class="custom-toast">
        <div class="toast-header">
            <div class="toast-icon">
                <i class="fas"></i>
            </div>
            <div class="toast-title"></div>
            <button class="toast-close" onclick="hideToast()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="toast-body"></div>
        <div class="toast-details"></div>
        <div class="toast-progress">
            <div class="toast-progress-bar"></div>
        </div>
    </div>
</head>
<body>
    <!-- Audio Element -->
    <audio id="packOpenSound" preload="auto">
        <source src="{{ url_for('static', filename='sounds/pack-open.mp3') }}" type="audio/mpeg">
    </audio>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('home') }}">
                <img src="{{ url_for('static', filename='image/STAR CATCHER FINAL LOGO-11.png') }}" alt="Star Catcher">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="navbar-nav ms-auto">
                    {% if user.is_authenticated %}
                        <span class="coins-display">
                            <i class="fas fa-coins me-2"></i>
                            {{ user.coins }} Coins
                        </span>
                        <a class="nav-link" href="{{ url_for('profile') }}">
                            <i class="fas fa-user me-2"></i>
                            Profile
                        </a>
                        <a class="nav-link" href="{{ url_for('myplayers') }}">
                            <i class="fas fa-users me-2"></i>
                            My Players
                        </a>
                        <a class="nav-link" href="{{ url_for('catalog') }}">
                            <i class="fas fa-book me-2"></i>
                            Catalog
                        </a>
                        <a class="nav-link" href="{{ url_for('market') }}">
                            <i class="fas fa-store me-2"></i>
                            Market
                        </a>
                        <a class="nav-link" href="{{ url_for('orders') }}">
                            <i class="fas fa-receipt me-2"></i>
                            Orders
                        </a>                        
                        <a class="nav-link text-danger" href="{{ url_for('logout') }}">
                            <i class="fas fa-sign-out-alt me-2"></i>
                            Logout
                        </a>
                    {% else %}
                        <a class="nav-link" href="{{ url_for('login') }}">
                            <i class="fas fa-sign-in-alt me-2"></i>
                            Login
                        </a>
                        <a class="nav-link" href="{{ url_for('register') }}">
                            <i class="fas fa-user-plus me-2"></i>
                            Register
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- World Cup Badge -->
    <div class="world-cup-badge">
        <i class="fas fa-trophy me-1"></i> World Cup 2026
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <h1 class="hero-title animate__animated animate__fadeInDown">Discover the World of Stars</h1>
            {% if current_user.subscription == 0 %}
                <div class="row mt-5 animate__animated animate__fadeInUp">
                    {% for sub in subscription %}
                        {% if current_user.country == 'eg' %}
                            <!-- إذا كان المستخدم في مصر، عرض الباقات التي داخل مصر (is_outside_egypt == 0) -->
                            {% if sub.is_outside_egypt == 0 %}
                                <div class="col-md-4">
                                    <div class="subscription-card vip-card {% if sub.has_vip_badge and sub.has_vip_badge_plus %}vip-elite{% elif sub.has_vip_badge_plus %}vip-plus{% elif sub.has_vip_badge %}vip{% endif %}">
                                        <div class="vip-badges">
                                            {% if sub.has_vip_badge and sub.has_vip_badge_plus %}
                                                <span class="vip-badge vip-elite">VIP ELITE</span>
                                            {% else %}
                                                {% if sub.has_vip_badge %}
                                                    <span class="vip-badge vip">VIP</span>
                                                {% endif %}
                                                {% if sub.has_vip_badge_plus %}
                                                    <span class="vip-badge vip-plus">VIP+</span>
                                                {% endif %}
                                            {% endif %}
                                        </div>
                                        <div class="card-header">
                                            <h3 class="card-title">{{ sub.package_type }}</h3>
                                        </div>
                                        <div class="card-body">
                                            <div class="package-price">
                                                {{ sub.price }}
                                                <small>{% if sub.is_outside_egypt %}USD{% else %}EGP{% endif %}</small>
                                            </div>

                                            <div class="package-details">
                                                <h4 class="mb-3">Package Features</h4>
                                                <div class="package-features">
                                                    {% if sub.coins_reward > 0 %}
                                                        <div class="feature-badge">
                                                            <i class="fas fa-coins"></i>
                                                            <span>{{ sub.coins_reward }} Free Coins</span>
                                                        </div>
                                                    {% endif %}

                                                    {% if sub.daily_free_packs > 0 %}
                                                        <div class="feature-badge">
                                                            <i class="fas fa-gift"></i>
                                                            <span>{{ sub.daily_free_packs }} Daily Free Packs</span>
                                                        </div>
                                                    {% endif %}

                                                    {% if sub.joker_players > 0 %}
                                                        <div class="feature-badge">
                                                            <i class="fas fa-star"></i>
                                                            <span>{{ sub.joker_players }} Joker Players</span>
                                                        </div>
                                                    {% endif %}

                                                    {% if sub.subscription_achievement_coins > 0 %}
                                                        <div class="feature-badge">
                                                            <i class="fas fa-trophy"></i>
                                                            <span>{{ sub.subscription_achievement_coins }} Achievement Coins</span>
                                                        </div>
                                                    {% endif %}

                                                    {% if sub.allow_old_ahly_catalog %}
                                                        <div class="feature-badge">
                                                            <i class="fas fa-book-open"></i>
                                                            <span>Legacy Al Ahly Catalog</span>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </div>

                                            <button class="subscription-btn {{ sub.package_type|lower }}-btn mt-4" 
                                                    data-subscription-id="{{ sub.id }}"
                                                    data-price="{{ sub.price }}"
                                                    data-currency="{% if sub.is_outside_egypt %}USD{% else %}EGP{% endif %}"
                                                    onclick="openPaymentModal(this)">
                                                <i class="fas fa-crown me-2"></i>
                                                Subscribe Now
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% else %}
                            <!-- إذا كان المستخدم خارج مصر، عرض الباقات التي خارج مصر (is_outside_egypt == 1) -->
                            {% if sub.is_outside_egypt == 1 %}
                                <div class="col-md-4">
                                    <div class="subscription-card vip-card {% if sub.has_vip_badge and sub.has_vip_badge_plus %}vip-elite{% elif sub.has_vip_badge_plus %}vip-plus{% elif sub.has_vip_badge %}vip{% endif %}">
                                        <div class="vip-badges">
                                            {% if sub.has_vip_badge and sub.has_vip_badge_plus %}
                                                <span class="vip-badge vip-elite">VIP ELITE</span>
                                            {% else %}
                                                {% if sub.has_vip_badge %}
                                                    <span class="vip-badge vip">VIP</span>
                                                {% endif %}
                                                {% if sub.has_vip_badge_plus %}
                                                    <span class="vip-badge vip-plus">VIP+</span>
                                                {% endif %}
                                            {% endif %}
                                        </div>
                                        <div class="card-header">
                                            <h3 class="card-title">{{ sub.package_type }}</h3>
                                        </div>
                                        <div class="card-body">
                                            <div class="package-price">
                                                {{ sub.price }}
                                                <small>{% if sub.is_outside_egypt %}USD{% else %}EGP{% endif %}</small>
                                            </div>

                                            <div class="package-details">
                                                <h4 class="mb-3">Package Features</h4>
                                                <div class="package-features">
                                                    {% if sub.coins_reward > 0 %}
                                                        <div class="feature-badge">
                                                            <i class="fas fa-coins"></i>
                                                            <span>{{ sub.coins_reward }} Free Coins</span>
                                                        </div>
                                                    {% endif %}

                                                    {% if sub.daily_free_packs > 0 %}
                                                        <div class="feature-badge">
                                                            <i class="fas fa-gift"></i>
                                                            <span>{{ sub.daily_free_packs }} Daily Free Packs</span>
                                                        </div>
                                                    {% endif %}

                                                    {% if sub.joker_players > 0 %}
                                                        <div class="feature-badge">
                                                            <i class="fas fa-star"></i>
                                                            <span>{{ sub.joker_players }} Joker Players</span>
                                                        </div>
                                                    {% endif %}

                                                    {% if sub.subscription_achievement_coins > 0 %}
                                                        <div class="feature-badge">
                                                            <i class="fas fa-trophy"></i>
                                                            <span>{{ sub.subscription_achievement_coins }} Achievement Coins</span>
                                                        </div>
                                                    {% endif %}

                                                    {% if sub.allow_old_ahly_catalog %}
                                                        <div class="feature-badge">
                                                            <i class="fas fa-book-open"></i>
                                                            <span>Legacy Al Ahly Catalog</span>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </div>

                                            <button class="subscription-btn {{ sub.package_type|lower }}-btn mt-4" 
                                                    data-subscription-id="{{ sub.id }}"
                                                    data-price="{{ sub.price }}"
                                                    data-currency="{% if sub.is_outside_egypt %}USD{% else %}EGP{% endif %}"
                                                    onclick="openPaymentModal(this)">
                                                <i class="fas fa-crown me-2"></i>
                                                Subscribe Now
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </div>
            {% endif %}

        </div>
    </section>

    <!-- Top Banner Section -->
    <div class="banner-container">
        <div class="container">
            <div class="banner-wrapper">
                <div class="banner-content">
                    <div class="banner-text">
                        <h3 class="banner-title">Win with Star Catcher! 🎮</h3>
                        <p class="banner-description">Subscribe now and get 1000 free coins to start collecting your favorite players</p>
                        <a href="/gift" class="banner-cta">
                            <i class="fas fa-gift me-2"></i>
                            Get Offer
                        </a>
                    </div>
                    <div class="banner-image">
                        <img src="{{ url_for('static', filename='image/promo-banner.jpg') }}" alt="Promotional Offer">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Packs Section -->
    <section class="container py-5">
        <div class="row">
            <div class="col-md-8">
                <h2 class="section-title">Available Packs</h2>
                <div class="row" id="packs-container">
                    <!-- سيتم إضافة الباكجات هنا ديناميكيًا -->
                </div>
            </div>
            
            <!-- Middle Banner -->
            <div class="col-md-8 mt-4">
                <div class="banner-wrapper">
                    <div class="banner-content">
                        <div class="banner-text">
                            <h3 class="banner-title">Road to Football Glory 🏆</h3>
                            <p class="banner-description">Get ready for the ultimate football showdown! Register now and be among the first 50 to qualify for free entry to the FIFA Club World Cup 2025!</p>
                            <a href="/coming-soon" class="banner-cta">
                                <i class="fas fa-star me-2"></i>
                                Discover More
                            </a>
                        </div>
                        <div class="banner-image">
                            <img src="{{ url_for('static', filename='image/elite-pack-banner.jpg') }}" alt="Elite Pack">
                        </div>
                    </div>
                </div>
            </div>

            <script>
                // جلب الباكجات عند تحميل الصفحة
                document.addEventListener("DOMContentLoaded", function() {
                    fetch('/api_packs', {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            const container = document.getElementById('packs-container');
                            data.packs.forEach(pack => {
                                const packHtml = `
                                    <div class="col-md-4 mb-4">
                                        <div class="pack-card" style="background-image: url('/static/uploads/packs/${pack.image_url}')">
                                            <div class="overlay"></div>
                                            <div class="card-body">
                                                <div class="pack-info">
                                                    <h4 class="pack-name">${pack.name}</h4>
                                                    <div class="pack-detail">
                                                        <i class="fas fa-users me-2"></i>
                                                        ${pack.player_count} Players
                                                    </div>
                                                    <span class="pack-price">
                                                        <i class="fas fa-coins me-2"></i>
                                                        ${pack.price} Coins
                                                    </span>
                                                </div>
                                                <button class="pack-btn open-pack" data-pack-id="${pack.id}">
                                                    <i class="fas fa-box-open me-2"></i>
                                                    Open Pack
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                                container.innerHTML += packHtml;
                            });
                        } else {
                            console.error('Error fetching packs:', data.message);
                        }
                    })
                    .catch(error => console.error('Error:', error));
                });
            </script>
            <div class="col-md-4">
                <div class="daily-pack-card">
                    <h3 class="daily-pack-title">Free Daily Pack</h3>
                    {% if can_open_daily %}
                        <button class="daily-pack-btn" id="openDailyPack">
                            <i class="fas fa-gift me-2"></i>
                            Open Daily Pack
                        </button>
                    {% else %}
                        <p class="countdown-text">
                            <div class="countdown-timer">
                                <div class="countdown-wrapper">
                                    <div class="countdown-unit">
                                        <div class="countdown-digit" id="hours">00</div>
                                        <span class="countdown-label">Hours</span>
                                    </div>
                                    <span class="countdown-separator">:</span>
                                    <div class="countdown-unit">
                                        <div class="countdown-digit" id="minutes">00</div>
                                        <span class="countdown-label">Minutes</span>
                                    </div>
                                    <span class="countdown-separator">:</span>
                                    <div class="countdown-unit">
                                        <div class="countdown-digit" id="seconds">00</div>
                                        <span class="countdown-label">Seconds</span>
                                    </div>
                                </div>
                            </div>
                        </p>
                    {% endif %}
                </div>
            </div>
            
        </div>
    </section>

    <!-- Update the confirm purchase modal -->
    <div class="modal fade" id="confirmPurchaseModal" tabindex="-1" role="dialog" aria-labelledby="confirmPurchaseModalLabel" aria-modal="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmPurchaseModalLabel">Confirm Pack Purchase</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to purchase this pack?</p>
                    <div class="pack-details">
                        <p class="pack-name mb-2"></p>
                        <p class="pack-price mb-2"></p>
                        <p class="pack-players mb-0"></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmPurchaseBtn">Confirm Purchase</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Update the pack opening modal -->
    <div class="modal fade" id="packModal" tabindex="-1" role="dialog" aria-labelledby="packModalLabel" aria-modal="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-body text-center py-5">
                    <div id="players-reveal" class="position-relative">
                        <!-- Players will be displayed here -->
                    </div>
                    <button class="add-to-collection-btn" id="addToCollection">
                        <i class="fas fa-plus-circle me-2"></i>
                        Add to Collection
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Daily Pack Modal -->
    <div class="modal fade" id="dailyPackModal" tabindex="-1" role="dialog" aria-labelledby="dailyPackModalLabel" aria-modal="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-body text-center py-5">
                    <div id="daily-players-reveal" class="position-relative">
                        <!-- Daily Pack Players will be displayed here -->
                    </div>
                    <button class="add-to-collection-btn" id="addDailyToCollection">
                        <i class="fas fa-plus-circle me-2"></i>
                        Add to Collection
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal fade" id="paymentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Choose Payment Method</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="subscription-details mb-4">
                        <h6>Subscription Details</h6>
                        <p class="package-name mb-2"></p>
                        <p class="package-price mb-0"></p>
                    </div>

                    <h6>Select Payment Method</h6>
                    <div class="payment-methods">
                        <div class="payment-method-item" onclick="selectPaymentMethod('vodafone-cash')">
                            <img src="{{ url_for('static', filename='image/vodafone-cash.png') }}" alt="Vodafone Cash">
                            <span>Vodafone Cash</span>
                        </div>
                        <div class="payment-method-item" onclick="selectPaymentMethod('etisalat-cash')">
                            <img src="{{ url_for('static', filename='image/etisalat-cash.png') }}" alt="Etisalat Cash">
                            <span>Etisalat Cash</span>
                        </div>
                        <div class="payment-method-item" onclick="selectPaymentMethod('we-pay')">
                            <img src="{{ url_for('static', filename='image/we-pay.png') }}" alt="We pay">
                            <span>We pay</span>
                        </div>
                        <div class="payment-method-item" onclick="selectPaymentMethod('orange-cash')">
                            <img src="{{ url_for('static', filename='image/orange-cash.png') }}" alt="orange cash">
                            <span>Orange cash</span>
                        </div>
                    </div>

                    <div class="payment-instructions mt-4" style="display: none;">
                        <!-- Payment instructions will be shown here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmPaymentBtn" disabled>
                        Confirm Payment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <style>
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .payment-method-item {
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payment-method-item:hover {
            border-color: var(--primary-red);
            transform: translateY(-2px);
        }

        .payment-method-item.selected {
            border-color: var(--primary-red);
            background: rgba(229, 9, 20, 0.1);
        }

        .payment-method-item img {
            width: 120px;
            height: 60px;
            object-fit: contain;
            margin-bottom: 10px;
        }

        .payment-method-item span {
            display: block;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .payment-instructions {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
        }
    </style>

    <!-- Add this after your existing modals -->
    <div class="modal fade" id="subscriptionRewardsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">مكافآت الاشتراك</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="rewards-container">
                        <!-- Coins Reward -->
                        <div class="reward-item" id="coinsReward">
                            <div class="reward-icon">
                                <i class="fas fa-coins"></i>
                            </div>
                            <div class="reward-details">
                                <h6>العملات المعدنية</h6>
                                <span class="coins-amount">0</span>
                            </div>
                            <button class="collect-btn" onclick="collectCoins()">
                                تحصيل
                            </button>
                        </div>

                        <!-- Joker Players -->
                        <div class="reward-item" id="jokersReward">
                            <div class="reward-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="reward-details">
                                <h6>لاعبين جوكر</h6>
                                <div class="jokers-container"></div>
                            </div>
                            <button class="collect-btn" onclick="collectJokers()">
                                تحصيل
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add these audio elements -->
    <audio id="coinCollectSound" preload="auto">
        <source src="{{ url_for('static', filename='sounds/coin-collect.mp3') }}" type="audio/mpeg">
    </audio>
    <audio id="rewardUnlockSound" preload="auto">
        <source src="{{ url_for('static', filename='sounds/reward-unlock.mp3') }}" type="audio/mpeg">
    </audio>

    <!-- Add these styles -->
    <style>
        .rewards-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .reward-item {
            background: linear-gradient(145deg, var(--dark-gray), var(--black));
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .reward-item.collected {
            opacity: 0.5;
            pointer-events: none;
        }

        .reward-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 193, 7, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--accent-gold);
        }

        .reward-details {
            flex-grow: 1;
        }

        .reward-details h6 {
            margin: 0;
            color: var(--text-light);
        }

        .coins-amount {
            font-size: 1.2rem;
            color: var(--accent-gold);
            font-weight: bold;
        }

        .collect-btn {
            background: var(--primary-red);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .collect-btn:hover {
            transform: scale(1.05);
            background: var(--dark-red);
        }

        .collect-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .jokers-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .joker-player {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .joker-player img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Flying coin animation */
        .flying-coin {
            position: fixed;
            width: 30px;
            height: 30px;
            background: var(--accent-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--black);
            font-weight: bold;
            pointer-events: none;
            z-index: 9999;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
    </style>

    <!-- إضافة نافذة عرض لاعبي الاشتراك -->
    <div class="modal fade" id="subscriptionPlayersModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">لاعبي الاشتراك الجدد</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center py-5">
                    <div id="subscription-players-reveal" class="position-relative">
                        <!-- سيتم إضافة اللاعبين هنا -->
                    </div>
                    <div class="subscription-coins mt-4">
                        <i class="fas fa-coins text-warning"></i>
                        <span id="subscription-coins-amount">0</span>
                        <button class="collect-coins-btn" onclick="collectSubscriptionCoins()">
                            تحصيل العملات
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti/dist/confetti.browser.min.js"></script>

    <script>
        // دوال مساعدة موحدة
        function getConfettiColors(rarity) {
            const colors = {
                'legendary': ['#FFD700', '#FFA500', '#FF8C00', '#FFD700'],
                'epic': ['#e50914', '#ff5722', '#ff4444', '#ff1744'],
                'rare': ['#1976d2', '#64b5f6', '#2196f3', '#0d47a1'],
                'common': ['#757575', '#bdbdbd', '#9e9e9e', '#616161']
            };
            return colors[rarity] || colors.common;
        }

        // دالة موحدة للاحتفالات
        function celebrateWithConfetti(rarity, intensity = 'normal') {
            const colors = getConfettiColors(rarity);
            const particleCount = intensity === 'high' ? 200 : 100;
            
            // من اليمين
            confetti({
                particleCount: particleCount,
                spread: 90,
                origin: { x: 0.9, y: 0.9 },
                angle: 135,
                startVelocity: 45,
                gravity: 0.5,
                drift: -0.4,
                ticks: 400,
                colors: colors
            });
            
            // من اليسار
            confetti({
                particleCount: particleCount,
                spread: 90,
                origin: { x: 0.1, y: 0.9 },
                angle: 45,
                startVelocity: 45,
                gravity: 0.5,
                drift: 0.4,
                ticks: 400,
                colors: colors
            });
            
            // من الوسط
            confetti({
                particleCount: particleCount * 1.5,
                spread: 180,
                origin: { x: 0.5, y: 1 },
                startVelocity: 45,
                gravity: 1,
                ticks: 400,
                colors: colors
            });
        }

        // دالة موحدة لعرض اللاعبين
        function displayPlayers(players, container, onComplete) {
            container.innerHTML = '';
            playPackOpenSound();
            
            players.forEach((player, index) => {
                setTimeout(() => {
                    const playerCard = document.createElement('div');
                    playerCard.className = 'player-card animate__animated animate__flipInY';
                    
                    // تصحيح مسار الصورة
                    const imgSrc = player.image_url ? `/static/uploads/image_player/${player.image_url}` : '/static/image/STAR CATCHER FINAL LOGO-11.png';
                    const defaultImage = '/static/image/STAR CATCHER FINAL LOGO-11.png';
                    
                    playerCard.innerHTML = `
                        <div class="player-image-container">
                            <img src="${imgSrc}" 
                                 alt="${player.name}"
                                 onerror="this.onerror=null; this.src='${defaultImage}'"
                                 loading="lazy">
                        </div>
                        <h4 class="player-name">${player.name}</h4>
                        <span class="player-rating">${player.rating}</span>
                        <div class="player-details mt-2">
                            <small class="d-block">${player.position}</small>
                            <small class="d-block">${player.club_name}</small>
                            <small class="d-block text-warning">${player.rarity}</small>
                        </div>
                    `;
                    container.appendChild(playerCard);
                    celebrateWithConfetti(player.rarity);

                    if (index === players.length - 1 && onComplete) {
                        onComplete();
                    }
                }, index * 1000);
            });
        }

        // معالج الباكج اليومي
        document.getElementById('openDailyPack')?.addEventListener('click', async function() {
            try {
                const dailyPackModal = new bootstrap.Modal(document.getElementById('dailyPackModal'));
                const response = await fetch('/generate_daily_pack', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.status === 401) {
                    alert('Please log in first');
                    window.location.href = '/login';
                    return;
                }

                const data = await response.json();

                if (data.status === 'success') {
                    dailyPackModal.show();
                    celebrateWithConfetti('rare', 'high');

                    const playersReveal = document.getElementById('daily-players-reveal');
                    displayPlayers(data.players, playersReveal, () => {
                        // تحديث واجهة المستخدم بعد اكتمال العرض
                        document.getElementById('openDailyPack').style.display = 'none';
                        updateCountdownDisplay();
                    });
                } else {
                    alert(data.message);
                }
            } catch (error) {
                console.error('❌ Error opening daily pack:', error);
                alert('An error occurred while opening the daily pack, please try again.');
            }
        });

        // معالج فتح الباكجات العادية
        document.addEventListener('click', async function(e) {
            if (e.target.classList.contains('open-pack') || e.target.closest('.open-pack')) {
                const packId = e.target.dataset.packId;
                try {
                    const response = await fetch(`/open_package/${packId}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });

                    if (response.status === 401) {
                        alert('Please log in first');
                        window.location.href = '/login';
                        return;
                    }

                    const data = await response.json();
                    if (data.status === 'success') {
                        const packModal = new bootstrap.Modal(document.getElementById('packModal'));
                        packModal.show();
                        
                        document.querySelector('.coins-display').textContent = 
                            `${data.coins_remaining} Coins`;

                        const playersReveal = document.getElementById('players-reveal');
                        displayPlayers(data.players_received, playersReveal);
                    } else {
                        alert(data.message);
                    }
                } catch (error) {
                    console.error('Error opening pack:', error);
                    alert('An error occurred while opening the pack');
                }
            }
        });

        // دالة تحديث عرض العداد
        function updateCountdownDisplay() {
            const countdownText = document.querySelector('.countdown-text');
            if (countdownText) {
                countdownText.innerHTML = `
                    <div class="countdown-timer">
                        <div class="countdown-wrapper">
                            <div class="countdown-unit">
                                <div class="countdown-digit" id="hours">24</div>
                                <span class="countdown-label">Hours</span>
                            </div>
                            <span class="countdown-separator">:</span>
                            <div class="countdown-unit">
                                <div class="countdown-digit" id="minutes">00</div>
                                <span class="countdown-label">Minutes</span>
                            </div>
                            <span class="countdown-separator">:</span>
                            <div class="countdown-unit">
                                <div class="countdown-digit" id="seconds">00</div>
                                <span class="countdown-label">Seconds</span>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // إضافة معالج لإغلاق النوافذ المنبثقة
        document.getElementById('addToCollection')?.addEventListener('click', function() {
            const modal = bootstrap.Modal.getInstance(document.getElementById('packModal'));
            if (modal) modal.hide();
        });

        document.getElementById('addDailyToCollection')?.addEventListener('click', function() {
            const modal = bootstrap.Modal.getInstance(document.getElementById('dailyPackModal'));
            if (modal) modal.hide();
        });

        // تحسين وظيفة العد التنازلي
        document.addEventListener("DOMContentLoaded", function() {
            const dailyPackCard = document.querySelector('.daily-pack-card');
            const countdownElement = document.getElementById("hours");
            if (!countdownElement) return;

            let dailyPackEndTimestamp = {{ daily_pack_end_timestamp | default(0) }};
            let countdownInterval;

            function handleDailyPack() {
                // إزالة العناصر الموجودة في البطاقة
                while (dailyPackCard.firstChild) {
                    dailyPackCard.firstChild.remove();
                }

                // إضافة العنوان
                const title = document.createElement('h3');
                title.className = 'daily-pack-title';
                title.textContent = 'Free Daily Pack';
                dailyPackCard.appendChild(title);

                const now = Math.floor(Date.now() / 1000);
                const timeRemaining = Math.floor(dailyPackEndTimestamp - now);

                if (timeRemaining > 0) {
                    // إضافة العداد إذا كان الوقت متبقي
                    const countdownHTML = `
                        <p class="countdown-text">
                            <div class="countdown-timer">
                                <div class="countdown-wrapper">
                                    <div class="countdown-unit">
                                        <div class="countdown-digit" id="hours">00</div>
                                        <span class="countdown-label">Hours</span>
                                    </div>
                                    <span class="countdown-separator">:</span>
                                    <div class="countdown-unit">
                                        <div class="countdown-digit" id="minutes">00</div>
                                        <span class="countdown-label">Minutes</span>
                                    </div>
                                    <span class="countdown-separator">:</span>
                                    <div class="countdown-unit">
                                        <div class="countdown-digit" id="seconds">00</div>
                                        <span class="countdown-label">Seconds</span>
                                    </div>
                                </div>
                            </div>
                        </p>`;
                    dailyPackCard.insertAdjacentHTML('beforeend', countdownHTML);
                    updateCountdown();
                } else {
                    // إضافة زر فتح الباكج إذا انتهى الوقت
                    const button = document.createElement('button');
                    button.className = 'daily-pack-btn';
                    button.id = 'openDailyPack';
                    button.innerHTML = '<i class="fas fa-gift me-2"></i>Open Daily Pack';
                    button.addEventListener('click', handleDailyPackClick);
                    dailyPackCard.appendChild(button);
                }
            }

            async function handleDailyPackClick() {
                try {
                    const dailyPackModal = new bootstrap.Modal(document.getElementById('dailyPackModal'));
                    const response = await fetch('/generate_daily_pack', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.status === 401) {
                        alert('Please log in first');
                        window.location.href = '/login';
                        return;
                    }

                    const data = await response.json();
                    if (data.status === 'success') {
                        dailyPackModal.show();
                        celebrateWithConfetti('rare', 'high');
                        
                        const playersReveal = document.getElementById('daily-players-reveal');
                        displayPlayers(data.players, playersReveal, () => {
                            dailyPackEndTimestamp = Math.floor(Date.now() / 1000) + 86400; // 24 ساعة
                            handleDailyPack();
                        });
                    } else {
                        alert(data.message);
                    }
                } catch (error) {
                    console.error('Error opening daily pack:', error);
                    alert('An error occurred while opening the daily pack');
                }
            }

            function updateCountdown() {
                const now = Math.floor(Date.now() / 1000);
                const timeRemaining = Math.floor(dailyPackEndTimestamp - now);

                if (timeRemaining > 0) {
                    const hours = Math.floor(timeRemaining / 3600);
                    const minutes = Math.floor((timeRemaining % 3600) / 60);
                    const seconds = Math.floor(timeRemaining % 60);

                    document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                    document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                    document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
                } else {
                    clearInterval(countdownInterval);
                    handleDailyPack();
                }
            }

            // بدء التطبيق
            handleDailyPack();
            if (dailyPackEndTimestamp) {
                countdownInterval = setInterval(updateCountdown, 1000);
            }
        });

        // دالة لتشغيل الصوت
        function playPackOpenSound() {
            const sound = document.getElementById('packOpenSound');
            sound.currentTime = 0;
            sound.play().catch(err => console.log('Audio playback failed:', err));
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Fetch subscriptions from API
            fetch('/api/subscriptions')
                .then(response => response.json())
                .then(subscriptions => {
                    const container = document.getElementById('subscriptionCards');
                    
                    subscriptions.forEach(sub => {
                        // Create badges HTML based on subscription features
                        const badges = [];
                        if (sub.has_vip_badge) badges.push('<span class="vip-badge vip">VIP</span>');
                        if (sub.has_vip_badge_plus) badges.push('<span class="vip-badge vip-plus">VIP+</span>');
                        
                        // Create features list
                        const features = [
                            { icon: 'coins', text: `${sub.coins_reward} Free Coins` },
                            { icon: 'gift', text: `${sub.daily_free_packs} Daily Free Packs` },
                            { icon: 'user-crown', text: `${sub.joker_players} Joker Players` },
                            { icon: 'trophy', text: `${sub.subscription_achievement_coins} Achievement Coins` }
                        ];

                        if (sub.allow_old_ahly_catalog) {
                            features.push({ icon: 'book-open', text: 'Legacy Al Ahly Catalog' });
                        }

                        const card = `
                            <div class="col-md-4">
                                <div class="subscription-card vip-card ${sub.package_type.toLowerCase()}">
                                    <div class="vip-badges">
                                        ${badges.join('')}
                                    </div>
                                    <div class="card-header">
                                        <h3 class="card-title">${sub.package_type}</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="package-price">
                                            ${sub.price}
                                            <small>${sub.is_outside_egypt ? 'USD' : 'EGP'}</small>
                                        </div>
                                        
                                        <div class="package-details">
                                            <h4 class="mb-3">Package Features</h4>
                                            <div class="package-features">
                                                ${features.map(feature => `
                                                    <div class="feature-badge">
                                                        <i class="fas fa-${feature.icon}"></i>
                                                        <span>${feature.text}</span>
                                                    </div>
                                                `).join('')}
                                            </div>
                                            ${sub.package_details.split('.').map(detail => 
                                                detail.trim() ? `
                                                    <div class="package-detail-item">
                                                        <i class="fas fa-check-circle"></i>
                                                        <span>${detail.trim()}</span>
                                                    </div>
                                                ` : ''
                                            ).join('')}
                                        </div>
                                        
                                        <button class="subscription-btn ${sub.package_type.toLowerCase()}-btn mt-4" 
                                                data-subscription-id="${sub.id}">
                                            <i class="fas fa-crown me-2"></i>
                                            Subscribe Now
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                        container.innerHTML += card;
                    });

                    // Add click handlers for subscription buttons
                    document.querySelectorAll('.subscription-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const subId = this.dataset.subscriptionId;
                            // Handle subscription purchase
                            console.log('Subscription selected:', subId);
                            // Add your subscription handling code here
                        });
                    });
                })
                .catch(error => console.error('Error fetching subscriptions:', error));
        });

        let selectedPaymentMethod = null;
        let currentSubscriptionId = null;

        function openPaymentModal(button) {
            // تأكد من أن النافذة المنبثقة موجودة في DOM
            const modalElement = document.getElementById('paymentModal');
            if (!modalElement) {
                console.error('Payment modal element not found');
                return;
            }

            const subscriptionId = button.dataset.subscriptionId;
            const price = button.dataset.price;
            const currency = button.dataset.currency;
            currentSubscriptionId = subscriptionId;

            // تحديث محتوى النافذة المنبثقة
            const packageName = button.closest('.subscription-card').querySelector('.card-title').textContent;
            modalElement.querySelector('.package-name').textContent = packageName;
            modalElement.querySelector('.package-price').textContent = `${price} ${currency}`;

            // إعادة تعيين حالة اختيار وسيلة الدفع
            selectedPaymentMethod = null;
            modalElement.querySelectorAll('.payment-method-item').forEach(item => {
                item.classList.remove('selected');
            });
            modalElement.querySelector('#confirmPaymentBtn').disabled = true;
            modalElement.querySelector('.payment-instructions').style.display = 'none';

            // إظهار النافذة المنبثقة باستخدام Bootstrap Modal
            const modal = new bootstrap.Modal(modalElement);
            modal.show();

            // التأكد من أن النافذة مرئية
            modalElement.style.display = 'block';
            modalElement.style.background = 'rgba(0, 0, 0, 0.5)';
        }

        function selectPaymentMethod(method) {
            selectedPaymentMethod = method;
            
            // Update UI
            document.querySelectorAll('.payment-method-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector(`[onclick="selectPaymentMethod('${method}')"]`).classList.add('selected');
            
            // Enable confirm button
            document.getElementById('confirmPaymentBtn').disabled = false;
            
            // Show payment instructions
            const instructionsDiv = document.querySelector('.payment-instructions');
            instructionsDiv.style.display = 'block';
            
            // Set instructions based on payment method
            const instructions = getPaymentInstructions(method);
            instructionsDiv.innerHTML = instructions;
        }

        function getPaymentInstructions(method) {
            const instructions = {
                'vodafone-cash': `
                    <h6>دفع آمن وسريع</h6>

                `,
                'etisalat-cash': `
                    <h6>دفع آمن وسريع</h6>
                    
                `,
                'we-pay': `
                    <h6>دفع آمن وسريع</h6>

                `,
                'orange-cash': `
                    <h6>دفع آمن وسريع</h6>

                `
                
            };
            return instructions[method];
        }

        // Add event listener for confirm payment button
        document.getElementById('confirmPaymentBtn').addEventListener('click', async function() {
            try {
                const response = await fetch('/api/purchase_subscription', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        subscription_id: currentSubscriptionId,
                        payment_method: selectedPaymentMethod
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    // Close payment modal
                    bootstrap.Modal.getInstance(document.getElementById('paymentModal')).hide();
                    
                    // Show success toast with subscription details
                    showToast('success', 'Subscription Success! 🎉', 'Your subscription has been activated successfully', {
                        'Package Type': data.data.type_subscription,
                        'Expiry Date': new Date(data.data.expiry_date).toLocaleDateString()
                    });
                    
                    // Reload page after 5 seconds
                    setTimeout(() => {
                        window.location.reload();
                    }, 5000);
                } else {
                    showToast('error', 'Subscription Failed ❌', data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while processing your payment. Please try again.');
            }
        });

        function showToast(type, title, message, details = null) {
            const toast = document.getElementById('subscriptionToast');
            const icon = toast.querySelector('.toast-icon i');
            const progressBar = toast.querySelector('.toast-progress-bar');
            
            // Reset animation
            progressBar.style.animation = 'none';
            progressBar.offsetHeight; // Trigger reflow
            progressBar.style.animation = null;
            
            // Update toast content
            toast.className = `custom-toast toast-${type}`;
            toast.querySelector('.toast-title').textContent = title;
            toast.querySelector('.toast-body').textContent = message;
            
            // Set icon
            icon.className = type === 'success' ? 'fas fa-check' : 'fas fa-times';
            
            // Add details if provided
            const detailsContainer = toast.querySelector('.toast-details');
            if (details) {
                let detailsHTML = '';
                for (const [label, value] of Object.entries(details)) {
                    detailsHTML += `
                        <div class="toast-detail-item">
                            <span class="toast-detail-label">${label}:</span>
                            <span class="toast-detail-value">${value}</span>
                        </div>
                    `;
                }
                detailsContainer.innerHTML = detailsHTML;
                detailsContainer.style.display = 'block';
            } else {
                detailsContainer.style.display = 'none';
            }
            
            // Show toast
            toast.classList.add('show');
            
            // Hide after 3 seconds
            setTimeout(hideToast, 5000);
        }

        function hideToast() {
            const toast = document.getElementById('subscriptionToast');
            toast.classList.remove('show');
        }

        // Update the confirm payment button event listener
        document.getElementById('confirmPaymentBtn').addEventListener('click', async function() {
            try {
                // إضافة مؤشر التحميل
                this.disabled = true;
                this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';

                const response = await fetch('/api/purchase_subscription', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        subscription_id: currentSubscriptionId,
                        payment_method: selectedPaymentMethod
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    // إغلاق نافذة الدفع
                    bootstrap.Modal.getInstance(document.getElementById('paymentModal')).hide();
                    
                    // عرض رسالة النجاح مع التفاصيل
                    showToast('success', 'Subscription Success! 🎉', 'Your subscription has been activated successfully', {
                        'Package Type': data.data.type_subscription,
                        'Expiry Date': new Date(data.data.expiry_date).toLocaleDateString()
                    });

                    // عرض مكافآت الاشتراك إذا كانت متوفرة
                    if (data.data.rewards) {
                        showSubscriptionRewards(data.data.rewards);
                    }
                    
                    // إعادة تحميل الصفحة بعد 5 ثوانٍ
                    setTimeout(() => {
                        window.location.reload();
                    }, 5000);
                } else {
                    showToast('error', 'Subscription Failed', data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while processing your payment. Please try again.');
            } finally {
                // إعادة تفعيل الزر وإزالة مؤشر التحميل
                this.disabled = false;
                this.innerHTML = 'Confirm Payment';
            }
        });

        // ...existing code...

        function showSubscriptionRewards(rewards) {
            const modal = new bootstrap.Modal(document.getElementById('subscriptionRewardsModal'));
            
            // Update rewards display
            document.querySelector('.coins-amount').textContent = rewards.coins_reward;
            
            const jokersContainer = document.querySelector('.jokers-container');
            jokersContainer.innerHTML = '';
            
            // Add joker players if any
            rewards.joker_players.forEach(player => {
                const jokerElement = document.createElement('div');
                jokerElement.className = 'joker-player';
                jokerElement.innerHTML = `
                    <img src="${player.image_url}" alt="${player.name}">
                `;
                jokersContainer.appendChild(jokerElement);
            });

            // Reset collect buttons
            document.querySelectorAll('.collect-btn').forEach(btn => {
                btn.disabled = false;
            });
            document.querySelectorAll('.reward-item').forEach(item => {
                item.classList.remove('collected');
            });

            modal.show();
            playSound('rewardUnlockSound');
        }

        function collectCoins() {
            const coinsAmount = parseInt(document.querySelector('.coins-amount').textContent);
            const currentCoins = parseInt(document.querySelector('.user-coins').textContent);
            const targetElement = document.querySelector('.user-coins');
            
            // Disable collect button
            document.querySelector('#coinsReward .collect-btn').disabled = true;
            document.querySelector('#coinsReward').classList.add('collected');

            // Create and animate multiple coins
            let collectedCount = 0;
            const totalCoins = Math.min(10, coinsAmount); // Max 10 visual coins

            for(let i = 0; i < totalCoins; i++) {
                setTimeout(() => {
                    createFlyingCoin(coinsAmount/totalCoins, targetElement, () => {
                        collectedCount++;
                        if(collectedCount === totalCoins) {
                            // Update final coins amount
                            targetElement.textContent = currentCoins + coinsAmount;
                            playSound('coinCollectSound');
                            createConfetti();
                        }
                    });
                }, i * 200);
            }
        }

        function createFlyingCoin(value, targetElement, onComplete) {
            const coin = document.createElement('div');
            coin.className = 'flying-coin';
            coin.innerHTML = '<i class="fas fa-coins"></i>';
            
            // Random starting position
            const startX = Math.random() * (window.innerWidth - 100) + 50;
            const startY = window.innerHeight - 100;
            
            coin.style.left = startX + 'px';
            coin.style.top = startY + 'px';
            document.body.appendChild(coin);

            // Get target position
            const targetRect = targetElement.getBoundingClientRect();
            const targetX = targetRect.left + targetRect.width/2;
            const targetY = targetRect.top + targetRect.height/2;

            // Animate to target
            requestAnimationFrame(() => {
                coin.style.left = targetX + 'px';
                coin.style.top = targetY + 'px';
                coin.style.opacity = '0';
                coin.style.transform = 'scale(0.5)';
            });

            // Cleanup
            setTimeout(() => {
                coin.remove();
                onComplete();
            }, 500);
        }

        function collectJokers() {
            document.querySelector('#jokersReward .collect-btn').disabled = true;
            document.querySelector('#jokersReward').classList.add('collected');
            
            // Animate joker cards collection
            const jokers = document.querySelectorAll('.joker-player');
            jokers.forEach((joker, index) => {
                setTimeout(() => {
                    joker.style.transform = 'scale(0)';
                    playSound('rewardUnlockSound');
                    createConfetti();
                }, index * 300);
            });
        }

        function playSound(soundId) {
            const sound = document.getElementById(soundId);
            sound.currentTime = 0;
            sound.play().catch(err => console.log('Audio playback failed:', err));
        }

        function createConfetti() {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Update your purchase subscription handler to show rewards
        function handleSubscriptionPurchase(response) {
            if(response.success) {
                showSubscriptionRewards(response.data);
            }
        }

        // تحديث معالج زر تأكيد الاشتراك
        document.getElementById('confirmPaymentBtn').addEventListener('click', async function() {
            try {
                this.disabled = true;
                this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';

                const response = await fetch('/api/purchase_subscription', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        subscription_id: currentSubscriptionId,
                        payment_method: selectedPaymentMethod
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    // إغلاق نافذة الدفع
                    bootstrap.Modal.getInstance(document.getElementById('paymentModal')).hide();
                    
                    // عرض نافذة اللاعبين
                    const playersModal = new bootstrap.Modal(document.getElementById('subscriptionPlayersModal'));
                    
                    // تحديث قيمة العملات
                    document.getElementById('subscription-coins-amount').textContent = data.data.coins_reward;
                    
                    // عرض اللاعبين باستخدام نفس دالة عرض الباكج
                    const playersContainer = document.getElementById('subscription-players-reveal');
                    displayPlayers(data.data.players, playersContainer, () => {
                        playersModal.show();
                        playSound('rewardUnlockSound');
                        celebrateWithConfetti('legendary', 'high');
                    });
                    
                    // تحديث النص في شريط العملات
                    document.querySelector('.coins-display').textContent = 
                        `${data.data.current_coins} Coins`;
                } else {
                    showToast('error', 'Subscription Failed', data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                showToast('error', 'Error', 'An error occurred');
            } finally {
                this.disabled = false;
                this.innerHTML = 'Confirm Payment';
            }
        });

        // دالة تحصيل عملات الاشتراك
        function collectSubscriptionCoins() {
            const coinsAmount = parseInt(document.getElementById('subscription-coins-amount').textContent);
            const coinsDisplay = document.querySelector('.coins-display');
            const currentCoins = parseInt(coinsDisplay.textContent.match(/\d+/)[0]);
            
            // تعطيل زر التحصيل
            const collectBtn = document.querySelector('.collect-coins-btn');
            collectBtn.disabled = true;
            
            // إنشاء وتحريك العملات
            let collectedCount = 0;
            const coinsToAnimate = Math.min(20, coinsAmount);
            
            for (let i = 0; i < coinsToAnimate; i++) {
                setTimeout(() => {
                    const coin = document.createElement('div');
                    coin.className = 'flying-coin';
                    coin.innerHTML = '<i class="fas fa-coins"></i>';
                    document.body.appendChild(coin);
                    
                    // موقع البداية العشوائي
                    const startX = Math.random() * window.innerWidth;
                    const startY = window.innerHeight - 100;
                    
                    // الموقع المستهدف (عداد العملات)
                    const targetRect = coinsDisplay.getBoundingClientRect();
                    const targetX = targetRect.left + targetRect.width / 2;
                    const targetY = targetRect.top + targetRect.height / 2;
                    
                    coin.style.left = `${startX}px`;
                    coin.style.top = `${startY}px`;
                    
                    requestAnimationFrame(() => {
                        coin.style.left = `${targetX}px`;
                        coin.style.top = `${targetY}px`;
                        coin.style.opacity = '0';
                        
                        playSound('coinCollectSound');
                        confetti({
                            particleCount: 5,
                            spread: 30,
                            origin: { x: targetX / window.innerWidth, y: targetY / window.innerHeight }
                        });
                    });
                    
                    setTimeout(() => {
                        coin.remove();
                        collectedCount++;
                        
                        if (collectedCount === coinsToAnimate) {
                            coinsDisplay.innerHTML = `<i class="fas fa-coins me-2"></i>${currentCoins + coinsAmount} Coins`;
                            collectBtn.style.display = 'none';
                        }
                    }, 500);
                }, i * 100);
            }
        }

        // تحديث معالج زر تأكيد الاشتراك بطريقة آمنة
        document.addEventListener('DOMContentLoaded', function() {
            const confirmBtn = document.getElementById('confirmPaymentBtn');
            if (confirmBtn) {
                confirmBtn.addEventListener('click', async function() {
                    try {
                        this.disabled = true;
                        this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';

                        const response = await fetch('/api/purchase_subscription', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                subscription_id: currentSubscriptionId,
                                payment_method: selectedPaymentMethod
                            })
                        });

                        const data = await response.json();
                        
                        if (data.success) {
                            // إغلاق نافذة الدفع
                            const paymentModal = bootstrap.Modal.getInstance(document.getElementById('paymentModal'));
                            if (paymentModal) paymentModal.hide();
                            
                            // عرض نافذة اللاعبين
                            const playersModal = new bootstrap.Modal(document.getElementById('subscriptionPlayersModal'));
                            
                            // تحديث قيمة العملات
                            const coinsElement = document.getElementById('subscription-coins-amount');
                            if (coinsElement) coinsElement.textContent = data.data.coins_reward;
                            
                            // عرض اللاعبين
                            const playersContainer = document.getElementById('subscription-players-reveal');
                            if (playersContainer) {
                                displayPlayers(data.data.players, playersContainer, () => {
                                    if (playersModal) playersModal.show();
                                    playSound('rewardUnlockSound');
                                    celebrateWithConfetti('legendary', 'high');
                                });
                            }
                            
                            // تحديث عداد العملات
                            const coinsDisplay = document.querySelector('.coins-display');
                            if (coinsDisplay) {
                                coinsDisplay.textContent = `${data.data.current_coins} Coins`;
                            }
                        } else {
                            showToast('error', 'Subscription Failed', data.message);
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        showToast('error', 'Error', 'An error occurred');
                    } finally {
                        this.disabled = false;
                        this.innerHTML = 'Confirm Payment';
                    }
                });
            }

            // تحديث باقي معالجات الأحداث
            const addToCollectionBtn = document.getElementById('addToCollection');
            if (addToCollectionBtn) {
                addToCollectionBtn.addEventListener('click', function() {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('packModal'));
                    if (modal) modal.hide();
                });
            }

            const addDailyToCollectionBtn = document.getElementById('addDailyToCollection');
            if (addDailyToCollectionBtn) {
                addDailyToCollectionBtn.addEventListener('click', function() {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('dailyPackModal'));
                    if (modal) modal.hide();
                });
            }

            const openDailyPackBtn = document.getElementById('openDailyPack');
            if (openDailyPackBtn) {
                openDailyPackBtn.addEventListener('click', handleDailyPackClick);
            }
        });
    </script>
</body>
</html>